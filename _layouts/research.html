---
layout: default
---

<!-- 1. 스타일 섹션 -->
<style>
  /* 카드 호버 시 어두워짐 효과 */
  .clickable-card .card {
    transition: filter 0.2s ease;
  }
  .clickable-card:hover .card {
    filter: brightness(0.85);
  }

  /* 태그 필터 바 스타일 (작은 버튼) */
  #tag-filter {
    margin: 1rem 0;
    font-size: 0.8rem;
  }
  #tag-filter .tag-button {
    display: inline-block;
    margin: 0.2rem 0.4rem 0.2rem 0;
    padding: 0.2rem 0.5rem;
    border-radius: 4px;
    border: 1px solid;
    cursor: pointer;
    transition: background 0.2s, color 0.2s;
  }
  #tag-filter .tag-button.active {
    box-shadow: inset 0 0 0 2px rgba(0,0,0,0.2);
  }

  /* 제목 드래그 커서 */
  .draggable-title {
    cursor: move;
    user-select: none;
  }
</style>

<!-- 2. Liquid 구문 오류 수정: hash 순회는 단일 변수로 key만 받고 value는 tags[key] 로 참조합니다 -->
<script>
  const tagColors = {
    {% assign tags = site.data.research_tags %}
    {% for tag in tags %}
      "{{ tag }}": "{{ tags[tag] }}"{% unless forloop.last %},{% endunless %}
    {% endfor %}
  };
</script>

<!-- 3. 태그 필터 바 -->
<div id="tag-filter">
  <span>Filter by Tags: </span>
  <!-- 기본 “All” 버튼 (흰 배경/회색 테두리) -->
  <span class="tag-button active" data-tag="All"
        style="background:#ffffff; border-color:#cccccc; color:#000000;">
    All
  </span>
</div>

{% if page.gallery %}
  {% assign galleries = site.data[page.gallery] %}
  {% for gallery in galleries %}
    <div class="columns is-multiline">
      <!-- 4. 드래그 가능한 제목 -->
      <div class="column is-12">
        <h1 class="has-text-left draggable-title"
            style="font-size:40px;"
            draggable="true">
          {{ gallery.title }}
        </h1>
      </div>

      {% for image in gallery.images %}
        <div class="column is-3-desktop is-4-tablet is-full-mobile gallery-item"
             {% if image.tags %}data-tags="{{ image.tags | join:',' }}"{% endif %}>
          <div class="clickable-card" data-href="{{ image.page_link }}">
            <div class="card"
                 style="
                   margin:0 auto;
                   text-align:center;
                   height:525px;
                   display:flex;
                   flex-direction:column;
                   justify-content:space-between;
                 ">
              
              <!-- 카드 상단: 이미지 -->
              <div>
                <div class="card-image">
                  {% include image-modal.html
                    link=image.link
                    alt=image.alt
                    large_link=image.large_link
                    ratio="is-16by9"
                  %}
                </div>
                <!-- 카드 본문 -->
                <div class="card-content" style="padding:10px;">
                  <div class="content"
                       style="text-align:left; font-size:1.0rem; color:black; font-weight:bold;">
                    <a href="{{ image.alt_link }}" target="_blank"
                       style="color:#0073e6; text-decoration:none;">
                      [{{ image.alt }}]
                    </a>
                    {{ image.paper }}
                  </div>
                  <div style="margin-top:10px; font-size:0.8rem; color:gray;">
                    {{ image.authors }}
                  </div>
                </div>
              </div>

              <!-- 카드 하단: 태그 및 출판일 -->
              <div style="margin-top:auto;">
                {% if image.tags %}
                  <div style="text-align:center; margin:2px 0;">
                    {% for tag in image.tags %}
                      {% assign tag_color = site.data.research_tags[tag] | default: "#666666" %}
                      <span style="
                        display:inline-block;
                        background-color:{{ tag_color }};
                        color:black;
                        border-radius:5px;
                        padding:2px 5px;
                        margin:2px;
                        font-size:0.6rem;
                        font-weight:bold;
                      ">
                        {{ tag }}
                      </span>
                    {% endfor %}
                  </div>
                {% endif %}

                <hr style="width:70%; margin:0 auto;">

                {% if image.date %}
                  <p style="
                      margin-top:10px;
                      margin-bottom:10px;
                      text-align:center;
                      font-size:1.0rem;
                      color:black;
                    ">
                    Published: {{ image.date }}
                  </p>
                {% endif %}
              </div>

            </div>
          </div>
        </div>
      {% endfor %}
    </div>
    <hr>
  {% endfor %}
{% endif %}

<!-- 5. 스크립트: 태그 필터링, 카드 클릭 이동, 제목 드래그 데이터 설정 -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const items     = Array.from(document.querySelectorAll('.gallery-item'));
    const filterBar = document.getElementById('tag-filter');

    // 태그 컬렉션 수집
    const tagSet = new Set();
    items.forEach(item => {
      if (!item.dataset.tags) return;
      item.dataset.tags.split(',').forEach(t => tagSet.add(t.trim()));
    });

    // 버튼 생성
    Array.from(tagSet).sort().forEach(tag => {
      const btn = document.createElement('span');
      btn.className    = 'tag-button';
      btn.dataset.tag = tag;
      btn.textContent = tag;
      // Liquid 데이터에서 가져온 색상으로 스타일 적용
      const color = tagColors[tag] || '#cccccc';
      btn.style.background  = color;
      btn.style.borderColor = color;
      btn.style.color       = 'black';
      filterBar.appendChild(btn);
    });

    // 필터 함수
    function filterItems(selectedTag) {
      items.forEach(item => {
        const tags = (item.dataset.tags||'').split(',').map(t=>t.trim());
        item.style.display = (selectedTag === 'All' || tags.includes(selectedTag))
                             ? '' : 'none';
      });
    }

    // 필터 바 클릭 이벤트
    filterBar.addEventListener('click', function(e) {
      const btn = e.target.closest('.tag-button');
      if (!btn) return;
      filterBar.querySelectorAll('.tag-button').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      filterItems(btn.dataset.tag);
    });

    // 기본 “All” 필터 적용
    filterItems('All');

    // 카드 클릭 시 이동
    document.querySelectorAll('.clickable-card').forEach(card => {
      card.style.cursor = 'pointer';
      card.addEventListener('click', function(e) {
        if (e.target.closest('a')) return;
        window.location.href = card.dataset.href;
      });
    });

    // 제목 드래그 시 텍스트 전송
    document.querySelectorAll('.draggable-title').forEach(title => {
      title.addEventListener('dragstart', function(e) {
        e.dataTransfer.setData('text/plain', e.target.textContent);
      });
    });
  });
</script>
